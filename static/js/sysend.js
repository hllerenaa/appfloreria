/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/sysend@1.12.1/sysend.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**@license
 *  sysend.js - send messages between browser windows/tabs version 1.12.1
 *
 *  Copyright (C) 2014-2022 Jakub T. Jankiewicz <https://jcubic.pl/me>
 *  Released under the MIT license
 *
 *  The idea for localStorage implementation came from this StackOverflow question:
 *  http://stackoverflow.com/q/24182409/387194
 *
 */
!function(n,e){"function"==typeof define&&define.amd?define(["sysend"],e):"object"==typeof exports?module.exports=e():n.sysend=e()}("undefined"!=typeof window?window:this,(function(){var n,e,t,r,o,i=400,a="___sysend___",c=new RegExp(a),u=Math.random(),s={},d={},f=[],m=0,l=!1,y=!0,p=0,_=0,v=(t=(new Date).getTime(),r=performance&&performance.now&&1e3*performance.now()||0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var e=16*Math.random();return t>0?(e=(t+e)%16|0,t=Math.floor(t/16)):(e=(r+e)%16|0,r=Math.floor(r/16)),("x"===n?e:3&e|8).toString(16)}))),w=1,h={primary:[],close:[],open:[],secondary:[],message:[],visbility:[],ready:[]},g=Object.keys(h),x=T(s,"to"),b=T(s,"from"),E={id:v,broadcast:function(n,t){return e?e.postMessage({name:n,data:x(t)}):(!function(n,e){0==p&&localStorage.setItem(a+n,u);localStorage.setItem(a+n,e)}(n,function(n){var e=[p++,u];void 0!==n&&e.push(n);var t=x(e);if(t===e)return JSON.stringify(e);return t}(t)),setTimeout((function(){var e;e=n,localStorage.removeItem(a+e)}),0)),function(n,e){f.forEach((function(t){var r={name:a,key:n,data:e};N(P(t.node.src))&&t.window.postMessage(JSON.stringify(r),"*")}))}(n,t),E},emit:function(n,e){return E.broadcast(n,e),C(n,e),E},serializer:function(n,e){if("function"!=typeof n||"function"!=typeof e)throw new Error("sysend::serializer: Invalid argument, expecting function");return s.to=n,s.from=e,E},proxy:function(){return[].slice.call(arguments).forEach((function(n){if("string"==typeof n&&S(n)!==window.location.host){(o=o||[]).push(P(n));var e=document.createElement("iframe");e.style.width=e.style.height=0,e.style.border="none";var t=n;n.match(/\.html$/)||(t=n.replace(/\/$/,"")+"/proxy.html"),e.addEventListener("error",(function t(){setTimeout((function(){throw new Error('html proxy file not found on "'+n+'" url')}),0),e.removeEventListener("error",t)})),e.addEventListener("load",(function n(){var t;try{t=e.contentWindow}catch(n){t=e.contentWindow}f.push({window:t,node:e}),e.removeEventListener("load",n)})),document.body.appendChild(e),e.src=t}})),!arguments.length&&J&&(l=!0),E},on:function(n,e){return d[n]||(d[n]=[]),d[n].push(e),E},off:function(n,e){if(d[n])if(e)for(var t=d[n].length;t--;)d[n][t]==e&&d[n].splice(t,1);else d[n]=[];return E},track:function(n,e){return g.includes(n)&&h[n].push(e),E},untrack:function(n,e){return g.includes(n)&&h[n].length&&(h[n]=void 0===e?[]:h[n].filter((function(n){return n!==e}))),E},post:function(n,e){return E.broadcast("__message__",{target:n,data:e,origin:v})},list:function(){var n=_++,e={target:v,id:n},t=k(E.timeout);return new Promise((function(r){var o=[];E.on("__window_ack__",(function(e){e.origin.target===v&&e.origin.id===n&&o.push({id:e.id,primary:e.primary})})),E.broadcast("__window__",{id:e}),t().then((function(){r(o)}))}))},channel:function(){return o=[].slice.apply(arguments).map(P),E},isPrimary:function(){return y}};Object.defineProperty(E,"timeout",{enumerable:!0,get:function(){return i},set:function(n){"number"!=typeof n||isNaN(n)||(i=n)}});var S=function(){if("undefined"!=typeof URL)return function(n){return(n=new URL(n)).host};var n=document.createElement("a");return function(e){return n.href=e,n.host}}();function k(n){return function(){return new Promise((function(e){setTimeout(e,n)}))}}var L,P=(L=document.createElement("a"),function(n){return L.href=n,L.origin}),I=[];function M(n){I.includes(n)||(I.push(n),console&&console.warn?console.warn(n):setTimeout((function(){throw new Error(n)}),0))}function N(n){if(!o)return M("Call sysend.channel() on iframe to restrict domains that can use sysend channel"),!0;var e=o.includes(n);return e||M(n+" domain is not on the list of allowed domains use sysend.channel() on iframe to allow access to this domain"),e}function O(n){var e=[].slice.call(arguments,1);n.forEach((function(n){n.apply(null,e)}))}function T(n,e){var t={from:"Unserialize",to:"Serialize"}[e]+" Error: ";return function(r){var o=n[e];try{return o?o(r):r}catch(n){M(t+n.message)}}}var J=function(){try{return window.self!==window.top}catch(n){return!0}}();function z(){return J&&l}function C(n,e){d[n].forEach((function(t){t(e,n)}))}function H(){y=!0,O(h.primary),E.emit("__primary__")}function R(){if("function"==typeof window.BroadcastChannel)(e=new window.BroadcastChannel(a)).addEventListener("message",(function(n){if(n.target.name===a)if(z()){var e={name:a,data:n.data,iframe_id:v};N(P(document.referrer))&&window.parent.postMessage(JSON.stringify(e),"*")}else{var t=n.data&&n.data.name;d[t]&&C(t,b(n.data.data))}}));else if(function(){try{return localStorage.setItem(a,1),localStorage.removeItem(a),!1}catch(n){return!0}}())M('Your browser don\'t support localStorgage. In Safari this is most of the time because of "Private Browsing Mode"');else{var t=new RegExp("^___sysend___");for(var r in localStorage)r.match(t)&&localStorage.removeItem(r);window.addEventListener("storage",(function(n){if(n.key.match(t)&&m++%2==0){var e=n.key.replace(t,"");if(d[e]){var r=n.newValue||function(n){return localStorage.getItem(a+n)}(e);if(r&&r!=u){var o=(c=b(i=r))===i?JSON.parse(i):c;o&&o[1]!=u&&C(e,o[2])}}}var i,c}),!1)}var o,i;z()?window.addEventListener("message",(function(n){if(function(n){return"string"==typeof n.data&&n.data.match(c)}(n)&&N(n.origin))try{var e=JSON.parse(n.data);if(e&&e.name===a){var t=b(e.data);E.broadcast(e.key,t)}}catch(n){}})):(void 0!==document.hidden?(o="hidden",i="visibilitychange"):void 0!==document.msHidden?(o="msHidden",i="msvisibilitychange"):void 0!==document.webkitHidden&&(o="webkitHidden",i="webkitvisibilitychange"),"function"==typeof document.addEventListener&&o&&document.addEventListener(i,(function(){O(h.visbility,!document[o])}),!1),E.track("visbility",(function(e){e&&!n&&H()})),E.on("__primary__",(function(){n=!0})),E.on("__open__",(function(n){var e=n.id;w++,y&&E.broadcast("__ack__"),O(h.open,{count:w,primary:n.primary,id:n.id}),e===v&&O(h.ready)})),E.on("__ack__",(function(){y||O(h.secondary)})),E.on("__close__",(function(e){var t=1===--w;e.wasPrimary&&!y&&(n=!1);var r={id:e.id,count:w,primary:e.wasPrimary,self:e.id===v};t&&H(),O(h.close,r)})),E.on("__window__",(function(n){E.broadcast("__window_ack__",{id:v,origin:n.id,primary:y})})),E.on("__message__",(function(n){n.target===v&&O(h.message,n)})),addEventListener("beforeunload",(function(){E.emit("__close__",{id:v,wasPrimary:y})}),{capture:!0}),function(){var n=Array.from(document.querySelectorAll("iframe"));return Promise.all(n.filter((function(n){return n.src})).map((function(n){return new Promise((function(e,t){n.addEventListener("load",(()=>{e()}),!0),n.addEventListener("error",t,!0)}))}))).then(k(E.timeout))}().then((function(){E.list().then((function(e){w=e.length,y=0===e.length,(e.find((function(n){return n.primary}))||y)&&(n=!0),E.emit("__open__",{id:v,primary:y}),y&&O(h.primary)}))})))}return"complete"===document.readyState?R():window.addEventListener("load",(function(){setTimeout(R,0)})),E}));
//# sourceMappingURL=/sm/b70f553991edc92a75cd43478cb2160ad5f2283c2bd60da72f49e8c6b69e5ab1.map